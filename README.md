# WeatherServiceApi
Cервис, который предоставляет API для работы с информацией о погоде.


## Описание сервиса

При запуске сервис сначала с помощью [geocoding-api](https://openweathermap.org/api/geocoding-api) получает информацию о 20-ти городах 
(названия которых храняться локально) и сохраняет ее в локальную базу. Храняться название, страна, и координаты города (необходимы для получения погоды).

Далее используя открытый API [open weather map](https://openweathermap.org/forecast5) и координаты городов
получает предсказание погоды на 5 дней и сохраняет результаты в БД. В БД в отдельных колонках храняться только:
- `temp` — температура днем
- `date` — дата предсказания
Всю остальная информация по соотвествующей дате храниться в отдельном поле в формате json.

**Данные о погоде обновляются раз в минуту в отдельной горутине.**

**Все запросы к внешним API происходят асинхронно.**

**База данных — PostgreSQL.**
Файлы миграции находяться в папке migrations, при запске контейнера через compose migrations_up.sql запускается автоматически.


## Запуск сервиса

Запустить Docker container:
```sh
docker-compose up --build
```
Флаг в конце, чтобы запустить без вывода консоли:
```sh
docker-compose up --build -d
```

**Исходя из конфигурации (файл config.yml) сервер запустится на localhost:8090/**

## API
Информация о погоде API:
| api  | Описание                                                                                                                |
|-------------|----------------------------------------------------------------------------------------------------------------------------|
| /api/сities | Список городов, для которых есть предсказания о погоде (отсортированный по названию).                                                                            |
| /api/cities/{city} | Список с кратким предсказанием для выбранного города: страна, название города, средняя температура на весь доступный будущий период, список дат для которых доступно предсказание в хронологическом порядке. |
| /api/cities/{city}/{date} | Детальная информация о погоде для конкретного города и конкретного времени.  |

Функционал пользователей:
| api  | Описание                                                                                                                |
|-------------|----------------------------------------------------------------------------------------------------------------------------|
| /api/users/{uuid} | GET: Получение id и email пользователя по uuid. |
| /api/users | GET: Получение id и email пользователя по параметрам email и password. |
| /api/users | POST: Регистрация нового пользователя. В body необходимо передать email, password и repeat_password. |
| /api/users/{uuid} | PATCH: Изменение сведений о пользователе. Можно сменить email, передав его и old_password в body, также можно задать new_password. Проверка пользователя происходит по uuid и old_password.  |
| /api/users/{uuid} | DELETE: Просто передать uuid пользователя в запросе. |
| /api/userfavs/ | GET: Получение избранных городов пользователя по параметрам email и password.  |
| /api/userfavs/{uuid} | POST: Добавление города в избранные пользователя. В body необходимо передать email, password и city_id. |
| /api/userfavs/{uuid} | DELETE: Удаление города из избранных пользователя. В body также необходимо передать email, password и city_id.  |

**Swagger docs:**
```sh
http://localhost:8090/doc/index.html
```
